# CoinMarketCap API 连接问题解决方案

## 🔍 问题诊断

测试结果显示：
- ✅ DNS 解析正常
- ✅ PowerShell 可以连接到 API（返回 401 是正常的）
- ❌ Node.js https 模块无法连接（ETIMEDOUT）

这说明是 **Node.js 的网络连接被阻止**，而不是 API 本身的问题。

## 💡 解决方案

### 方案 1: 检查 Windows 防火墙（推荐）

1. 打开 **Windows 安全中心** → **防火墙和网络保护**
2. 检查是否有阻止 Node.js 的规则
3. 或者临时关闭防火墙测试（不推荐长期使用）

### 方案 2: 检查杀毒软件/安全软件

某些安全软件（如 360、火绒等）可能会阻止 Node.js 的网络连接：
1. 检查安全软件的防火墙/网络保护设置
2. 将 Node.js 添加到白名单
3. 或者临时关闭测试

### 方案 3: 使用 GitHub Actions（推荐）

由于本地网络环境可能有限制，建议直接在 GitHub Actions 中运行：

1. **配置 GitHub Secrets**：
   - 进入 GitHub 仓库：https://github.com/thstoqd/cryptologo
   - Settings → Secrets and variables → Actions
   - 添加 `COINMARKETCAP_API_KEY` secret

2. **手动触发测试**：
   - 进入 Actions 标签页
   - 找到 "更新代币排名" workflow
   - 点击 "Run workflow" 手动触发
   - 查看运行日志

GitHub Actions 的网络环境通常更稳定，不会有本地防火墙限制。

### 方案 4: 配置代理（如果使用代理）

如果你使用代理，需要配置 Node.js 使用代理：

```powershell
# 设置代理环境变量
$env:HTTP_PROXY="http://代理地址:端口"
$env:HTTPS_PROXY="http://代理地址:端口"

# 然后运行脚本
node scripts/update-ranks.js
```

### 方案 5: 使用 VPN 或更换网络

如果以上方法都不行，可以尝试：
- 使用 VPN
- 更换网络环境（如手机热点）
- 在另一台电脑上测试

## 🎯 推荐做法

**最佳方案**：直接在 GitHub Actions 中运行，因为：
- ✅ 不需要配置本地网络
- ✅ 自动每天运行
- ✅ 网络环境稳定
- ✅ 自动提交更新

本地测试主要用于开发调试，实际运行建议使用 GitHub Actions。

## 📝 验证 GitHub Actions 配置

1. 确认 GitHub Secrets 已配置 `COINMARKETCAP_API_KEY`
2. 手动触发一次 workflow 测试
3. 查看运行日志确认是否成功

如果 GitHub Actions 可以正常运行，说明配置正确，本地网络问题不影响自动更新功能。

