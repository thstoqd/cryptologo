# 本地测试排名更新脚本

## 📋 步骤 1: 获取 CoinMarketCap API Key

1. 访问 https://coinmarketcap.com/api/
2. 点击 **"Get Your API Key Now"** 注册账号
3. 选择 **Basic 免费版**（每月 10,000 次调用，完全够用）
4. 创建 API Key 后，复制保存（类似：`12345678-1234-1234-1234-123456789abc`）

## 🔧 步骤 2: 在 PowerShell 中运行

### 方法 A: 临时设置（推荐测试用）

打开 PowerShell，在项目目录下运行：

```powershell
# 设置环境变量（替换为你的实际 API Key）
$env:COINMARKETCAP_API_KEY="你的API_KEY"

# 运行脚本
node scripts/update-ranks.js
```

**注意**: 这种方式只在当前 PowerShell 窗口有效，关闭窗口后需要重新设置。

### 方法 B: 永久设置（系统环境变量）

1. 按 `Win + R`，输入 `sysdm.cpl`，回车
2. 点击 **"高级"** 标签页
3. 点击 **"环境变量"**
4. 在 **"用户变量"** 或 **"系统变量"** 中点击 **"新建"**
5. 变量名：`COINMARKETCAP_API_KEY`
6. 变量值：你的 API Key
7. 点击 **"确定"** 保存

设置后，在任何 PowerShell 窗口都可以直接运行：
```powershell
node scripts/update-ranks.js
```

## ✅ 步骤 3: 验证结果

脚本运行成功后，你会看到类似输出：

```
开始更新代币排名...
正在从 CoinMarketCap API 获取排名数据...
✅ 成功获取 5000 个代币的排名数据
更新 Bitcoin (BTC): 1 → 1
更新 Ethereum (ETH): 2 → 2
...

更新完成!
- 成功更新: 15 个代币
- 未找到排名: 0 个代币
```

然后检查 `data/icons-metadata.json` 文件：
- `lastUpdated` 字段会更新为最新时间
- 各个代币的 `rank` 字段会更新为 CoinMarketCap 的最新排名

## ⚠️ 常见问题

### 问题 1: "错误: 未设置 COINMARKETCAP_API_KEY 环境变量"
**解决**: 确保在运行脚本前设置了环境变量，或者使用系统环境变量

### 问题 2: "API 错误: Invalid API Key"
**解决**: 
- 检查 API Key 是否正确复制（没有多余空格）
- 确认 API Key 在 CoinMarketCap 中处于激活状态

### 问题 3: "网络请求失败"
**解决**: 
- 检查网络连接
- 确认可以访问 https://pro-api.coinmarketcap.com

